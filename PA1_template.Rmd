# Reproducible Research: Peer Assessment 1
This assignment makes use of data from a personal activity monitoring device.
This device collects data at 5 minute intervals through out the day. The data
consists of two months of data from an anonymous individual collected during
the months of October and November, 2012 and include the number of steps
taken in 5 minute intervals each day.

## Loading and preprocessing the data
The data file (activity.zip) was unzipped into the default directory.  The data file (activity.csv) was loaded with read.csv with no parameters.  

summary() revieled 2304 NAs.  

str() shows the dataset includes the following columns:  steps (int), date (Factor) and interval(int). 

For immediate analysis, NAs were removed, creating activeComplete. A day of the week was derived from the date using weekdays() to facilitate additional subsetting and analysis.


```{r}
setwd("C:\\Users\\srobin\\Documents\\GitHub\\RepData_PeerAssessment1")
unzip(paste0(getwd(),"\\","activity.zip"))
active <- read.csv(paste0(getwd(),"\\","activity.csv"))

summary(active)

str(active)

activeComplete <- active[complete.cases(active),]
activeComplete$dow <- weekdays(as.Date(activeComplete$date))
summary(activeComplete)

```


## What is mean total number of steps taken per day?

Complete cases was aggregated by date to derive 53 days of observations and summed for each day.  A histogram shows the frequency of the steps per day was around 10,000, closely matching a summary of this data, with a mean of 10,766 and a median of 10,765.

```{r echo=FALSE}
## histogram of the total number of steps taken each day
perDay <- activeComplete[,1:2]
sum_steps_per_Day <- aggregate(.~ date, data=perDay,sum)

hist(sum_steps_per_Day$steps, plot=TRUE, main="Histogram of Total Steps each Day")
# summary(sum_steps_per_Day)

```



```{r echo=FALSE}
## mean and median number of steps taken each day

mSteps_per_Day <- aggregate(.~ date, data=perDay,sum)
mSteps <- mean(mSteps_per_Day$steps)
medSteps <- median(mSteps_per_Day$steps)

```

### Mean and Median  
- Mean: `r mSteps`
- Median:  `r medSteps`

## What is the average daily activity pattern?
Is there a 

```{r}
## time series plot of the average number of steps taken 
## (averaged across all days) versus the 5-minute intervals

daily <- activeComplete[,c(1,3)]
  pattern <- aggregate(.~ interval,data=daily, mean, na.rm=TRUE)
  plot(pattern$interval,pattern$steps, type="l", main="Time Series of Average \n Number of Steps per Day")

```


```{r}
## 5-minute interval that, on average, contains the maximum number of steps

  maxSteps <- subset(pattern, steps == max(pattern$steps))
  maxSteps

```

The average daily activity show increasing activity at Interval 500 (5:00am) and a sharp spike around Interval 800 (8:00am).  Maximum activity occurs at Interval 835 (8:30am).  Activity fluxuates across the day, until around Interval 1900 (7:00pm), where it declines quickly and tappers off after 2000 (10:00pm).


## Inputing missing values

Where data was missing steps (NA), steps were estimated by using the mean of the corresponding interval and day of the week of records that had complete data.  A dataset of complete cases was created, along with Weekdays() function to create a 'Day-of-the-Week'column (dow). 

The dataset was grouped by interval + dow, creating a mean of each interval by day. Missing data is replaced day by day through a loop of missing dates.

```{r echo=FALSE}

## strategy for imputing missing data
# Just for fun
# library(mice)
# miced <- mice(active)
# library(Amelia)
# a <- amelia(x=active,idvars="date")
# head(a$imputations$imp5)

# Duplicate dataframe to be used to append replacement data
replaceMissing <- active[complete.cases(active),]
replaceMissing$dow <- weekdays(as.Date(replaceMissing$date))

# Replacement data
mean_steps_per_Day <- aggregate(replaceMissing$steps, 
                                by=list(interval = replaceMissing$interval,
                                        dow = replaceMissing$dow),
                                            FUN=mean)


dowMean <- mean_steps_per_Day[,1:3]
names(dowMean)[1:3] <-  c("interval","dow","steps")

# Dataset where steps are NA
missing <- subset(active, is.na(active$steps))
missing$dow <- weekdays(as.Date(missing$date))

# get the Dates and DOW where data is missing
miss <- aggregate(missing$steps,by=list(date=missing$date),mean)
miss$dow <- weekdays(as.Date(miss$date))



for(i in 1:nrow(miss)){

  mUse <- subset(missing,missing$date == miss$date[i])
  iData <- subset(mean_steps_per_Day, mean_steps_per_Day$dow == miss$dow[i])
  names(iData)[3] <- "steps"
  
  mUse$steps <- ifelse(is.na(mUse$steps),
                          iData$steps[mUse$interval==iData$interval] ,
                          mUse$steps)
  
  # merge missing and activeComplete 
  replaceMissing <- rbind(mUse,replaceMissing)
 
  
}


meanActiveComplete <- mean(activeComplete$steps)
meanReplaceMissing <- mean(replaceMissing$steps)



```
```{r}
summary(replaceMissing)
```
The introduction of Replaced data has slightly raised the mean,   
- from `r meanActiveComplete`  
- to `r meanReplaceMissing`

## Are there differences in activity patterns between weekdays and weekends?
```{r echo=FALSE}
# Multiple plot function
# http://www.cookbook-r.com/Graphs/Multiple_graphs_on_one_page_(ggplot2)/

# ggplot objects can be passed in ..., or to plotlist (as a list of ggplot objects)
# - cols:   Number of columns in layout
# - layout: A matrix specifying the layout. If present, 'cols' is ignored.
#
# If the layout is something like matrix(c(1,2,3,3), nrow=2, byrow=TRUE),
# then plot 1 will go in the upper left, 2 will go in the upper right, and
# 3 will go all the way across the bottom.
#
multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
  require(grid)
  
  # Make a list from the ... arguments and plotlist
  plots <- c(list(...), plotlist)
  
  numPlots = length(plots)
  
  # If layout is NULL, then use 'cols' to determine layout
  if (is.null(layout)) {
    # Make the panel
    # ncol: Number of columns of plots
    # nrow: Number of rows needed, calculated from # of cols
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                     ncol = cols, nrow = ceiling(numPlots/cols))
  }
  
  if (numPlots==1) {
    print(plots[[1]])
    
  } else {
    # Set up the page
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))
    
    # Make each plot, in the correct location
    for (i in 1:numPlots) {
      # Get the i,j matrix positions of the regions that contain this subplot
      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))
      
      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}
```

```{r}
## histogram of the total number of steps taken each day after missing values were 
## imputed
perDay_after <- replaceMissing[,1:2]
sum_steps_per_Day_after <- aggregate(.~ date, data=perDay_after,sum)

hist(sum_steps_per_Day_after$steps, plot=TRUE, main="Histogram of Total Steps\n each Day After Missing Values are Input")

# create a factor for Weekend - Weekend or Weekday
replaceMissing$weekend <- factor(ifelse(replaceMissing$dow %in% c("Saturday", "Sunday"), "Weekend", "Weekday"))

weekend <- subset(replaceMissing, replaceMissing$weekend == "Weekend")
weekday <- subset(replaceMissing, replaceMissing$weekend == "Weekday")



weekEnd <- aggregate(weekend$steps, 
                       by=list(inter=weekend$interval, 
                               we=weekend$weekend),
                       mean)

weekDay <- aggregate(weekday$steps, 
                       by=list(inter=weekday$interval, 
                               we=weekday$weekend),
                       mean)

# arrange by day of the week starting Monday
#dayofweek$day <- factor(dayofweek$Group.1, levels= c( "Monday", 
#    "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday","Sunday"))
#dayofweek[order(dayofweek$day), ]


## panel plot comparing the average number of steps taken per 
## 5-minute interval across weekdays and weekends

library(ggplot2)
p1 <- ggplot(weekEnd, aes(x=inter,y=x)) + 
  geom_line() +
  labs(title="Weekend Pattern of Steps",y="Steps", x="Interval")
 

p2 <- ggplot(weekDay, aes(x=inter,y=x)) + 
  geom_line() +
  labs(title="Weekday Pattern of Steps", y="Steps", x="Interval")

# multiplot from R Cookbook
multiplot(p1, p2, cols=1)

```

[multiplot from R Cookbook](http://www.cookbook-r.com/Graphs/Multiple_graphs_on_one_page_(ggplot2)/)

